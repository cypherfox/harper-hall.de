<!doctype html><html class=no-js lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Setting up the YubiKey - Harper Hall</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content>
<meta property="og:title" content="Setting up the YubiKey">
<meta property="og:description" content="This is my adpation of https://github.com/drduh/YubiKey-Guide
Here I skip the machine setup covery by Dr. Duh. The short of it is: you need a machine with a current kernal that is disconnecte from the network.
Below are my choices and changes. This is even more opinionated than his document.
Creating Keys Setup the environment:
$ export GNUPGHOME=$(mktemp -d) $ wget -O $GNUPGHOME/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf Generate a Pin $ tr -dc '[:upper:]' < /dev/urandom | fold -w 20 | head -n1 Write down the pin and keep in safe place.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://harper-hall.de/pages/setting-up-yubikey/"><meta property="article:section" content="pages">
<meta property="article:published_time" content="2021-08-01T00:00:00+00:00">
<meta property="article:modified_time" content="2021-08-01T00:00:00+00:00">
<meta itemprop=name content="Setting up the YubiKey">
<meta itemprop=description content="This is my adpation of https://github.com/drduh/YubiKey-Guide
Here I skip the machine setup covery by Dr. Duh. The short of it is: you need a machine with a current kernal that is disconnecte from the network.
Below are my choices and changes. This is even more opinionated than his document.
Creating Keys Setup the environment:
$ export GNUPGHOME=$(mktemp -d) $ wget -O $GNUPGHOME/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf Generate a Pin $ tr -dc '[:upper:]' < /dev/urandom | fold -w 20 | head -n1 Write down the pin and keep in safe place."><meta itemprop=datePublished content="2021-08-01T00:00:00+00:00">
<meta itemprop=dateModified content="2021-08-01T00:00:00+00:00">
<meta itemprop=wordCount content="517">
<meta itemprop=keywords content="yubikey,lang-en,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Setting up the YubiKey">
<meta name=twitter:description content="This is my adpation of https://github.com/drduh/YubiKey-Guide
Here I skip the machine setup covery by Dr. Duh. The short of it is: you need a machine with a current kernal that is disconnecte from the network.
Below are my choices and changes. This is even more opinionated than his document.
Creating Keys Setup the environment:
$ export GNUPGHOME=$(mktemp -d) $ wget -O $GNUPGHOME/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf Generate a Pin $ tr -dc '[:upper:]' < /dev/urandom | fold -w 20 | head -n1 Write down the pin and keep in safe place.">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<div class="container header__container">
<div class="logo logo--mixed">
<a class=logo__link href=/ title="Harper Hall" rel=home>
<div class="logo__item logo__imagebox">
<img class=logo__img src=/images/avatar.png>
</div><div class="logo__item logo__text">
<div class=logo__title>Harper Hall</div>
<div class=logo__tagline>a house for learning, music and enterntainment (except the music)</div>
</div>
</a>
</div>
<nav class=menu>
<button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span>
</button>
<ul class=menu__list>
<li class=menu__item>
<a class=menu__link href=/about/>
<span class=menu__text>About Harper Hall</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/pages/books/>
<span class=menu__text>Books of Interest</span>
</a>
</li>
<li class=menu__item>
<a class=menu__link href=/pages/things-of-interest/>
<span class=menu__text>Things of Interest</span>
</a>
</li>
</ul>
</nav>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>Setting up the YubiKey</h1>
<div class="post__meta meta"><div class="meta__item-author meta__item">
<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>Lutz Behnke</span>
</div>
<div class="meta__item-datetime meta__item">
<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2021-08-01T00:00:00Z>2021-08-01</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/system-administration/ rel=category>System Administration</a>
</span>
</div></div>
</header>
<div class="post__toc toc">
<div class=toc__title>Page content</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#generate-a-pin>Generate a Pin</a></li>
<li><a href=#generate-a-master-key>Generate a master key</a></li>
<li><a href=#sub-keys>Sub-Keys</a></li>
<li><a href=#verify>Verify</a></li>
<li><a href=#export-the-private-keys>Export the private keys</a></li>
<li><a href=#make-the-public-key-available>make the public key available</a></li>
</ul>
</nav>
</div>
</div><div class="content post__content clearfix">
<p>This is my adpation of <a href=https://github.com/drduh/YubiKey-Guide>https://github.com/drduh/YubiKey-Guide</a></p>
<p>Here I skip the machine setup covery by Dr. Duh. The short of it is: you need a machine with a current kernal that is disconnecte from the network.</p>
<p>Below are my choices and changes. This is even more opinionated than his document.</p>
<h1 id=creating-keys>Creating Keys</h1>
<p>Setup the environment:</p>
<pre tabindex=0><code>$ export GNUPGHOME=$(mktemp -d)
$ wget -O $GNUPGHOME/gpg.conf https://raw.githubusercontent.com/drduh/config/master/gpg.conf
</code></pre><h2 id=generate-a-pin>Generate a Pin</h2>
<pre tabindex=0><code>$ tr -dc '[:upper:]' &lt; /dev/urandom | fold -w 20 | head -n1
</code></pre><p>Write down the pin and keep in safe place. Who ever gets the pin and the yubikey will own you!</p>
<h2 id=generate-a-master-key>Generate a master key</h2>
<p>Run this command using the default language, as the localized version only accepts locallized command keys, that may differ from the ones documented here.</p>
<p>Take the PIN into your clipboard before you begin, as the Password dialog will not allow you to switch focus.</p>
<pre tabindex=0><code>$ LANG=C gpg --expert --full-generate-key
</code></pre><p>Select <code>8</code> (RSA with own capabilities) and remove all capabilities except <code>Certitify</code> (See the section on the <a href>Master Key</a><a href=https://github.com/drduh/YubiKey-Guide#master-key>https://github.com/drduh/YubiKey-Guide#master-key</a>) in Dr. Duh&rsquo;s guide.</p>
<p>Enter your name and email address, leave the comment field empty.</p>
<p>Export the key ID as a variable. It will be given in a format <code>&lt;algorithm>&lt;key length>/&lt;key ID></code>, e.g. <code>rsa4096/0xAF3E7A88447EB2DB</code> close to the end of the output from the key generation command.</p>
<pre tabindex=0><code>$ export KEYID=0xAF3E7A88447EB2DB
</code></pre><h2 id=sub-keys>Sub-Keys</h2>
<p>Edit key</p>
<pre tabindex=0><code>$ LANG=C gpg --expert --edit-key $KEYID
</code></pre><p>Add a signing key with the command <code>addkey</code> then select <code>(4) RSA (sign only)</code> and choose 4096 bits of key length. Make key valid for 2 years.</p>
<p>Add an encrpytion key with the command <code>addkey</code> then select <code>(6) RSA (enrcrypt only)</code> and choose 4096 bits of key length. Make key valid for 2 years.</p>
<p>Add an authentication key. There is no pre-provided template for the so after the command <code>addkey</code> select <code>(8) RSA (set your own capabilities</code> and configure the allowed actions to only show <code>Authenticate</code> and choose 4096 bits of key length. Set the validity to 2 years.</p>
<h2 id=verify>Verify</h2>
<p>If you have not already, install the <code>hopenpgp-tools</code> for Ubuntu</p>
<pre tabindex=0><code>$ sudo apt-get install hopenpgp-tools
</code></pre><p>verfiy that best practices are kept. The check will print an error for the the unlimited validity of the master key and a warning for the lack of an embedded cross certification of the Authorization key.</p>
<pre tabindex=0><code>$ gog --export $KEYID | hokey lint
</code></pre><h2 id=export-the-private-keys>Export the private keys</h2>
<p>(Take Passphrase into clipboard first)</p>
<pre tabindex=0><code>LANG=C gpg --armor --export-secret-keys $KEYID &gt; $GNUPGHOME/mastersub.key
LANG=C gpg --armor --export-secret-subkeys $KEYID &gt; $GNUPGHOME/mastersub.key
</code></pre><p>Also export a revocation cert for the master key</p>
<pre tabindex=0><code>LANG=C gpg --output $GNUPGHOME/revoke.asc --gen-revoke $KEYID
</code></pre><h2 id=make-the-public-key-available>make the public key available</h2>
<pre tabindex=0><code>LANG=C gpg --armor --export $KEYID &gt; $GNUPGHOME/gpg-$KEYID-$(date +%F).txt
</code></pre><p>This should then be uploaded to a keyserver</p>
<h1 id=upload-to-smartcard>Upload to smartcard</h1>
<pre tabindex=0><code>LANG=C gpg --edit-card
</code></pre><h1 id=use-the-yubikey-on-a-different-computer>Use the Yubikey on a different computer</h1>
<p>After installing GnuPG (and possibly wget), based on the operating system execute the following:</p>
<pre tabindex=0><code>cd
mkdir .gnupg
chmod go-rx .gnupg
cd .gnupg
wget https://raw.githubusercontent.com/drduh/config/master/gpg.conf
</code></pre><p>Then copy the file <code>$GNUPGHOME/gpg-$KEYID-$(date +%F).txt</code> to the new machine. We will assume <code>$PUBKEYFILE</code> to be the name of the file created on the target machine.
Then import the public keys:</p>
<pre tabindex=0><code>gpg --import $PUBKEYFILE
</code></pre>
</div>
<footer class=post__footer>
<div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/yubikey/ rel=tag>yubikey</a>
</li>
<li class=tags__item>
<a class="tags__link btn" href=/tags/lang-en/ rel=tag>lang-en</a>
</li>
</ul>
</div>
</footer>
</article>
</main>
<div class="authorbox clearfix">
<figure class=authorbox__avatar>
<img alt="Lutz Behnke avatar" src=/images/avatar.png class=avatar height=90 width=90>
</figure>
<div class=authorbox__header>
<span class=authorbox__name>About Lutz Behnke</span>
</div>
<div class=authorbox__description>
Distributed Systems since &lsquo;92, Roleplaying Games since &lsquo;84, Politics since &lsquo;77. Opinions are my own; he/him
</div>
</div>
<nav class="pager flex">
<div class="pager__item pager__item--prev">
<a class=pager__link href=/pages/books/ rel=prev>
<span class=pager__subtitle>«&#8201;Previous</span>
<p class=pager__title>Books of Interest</p>
</a>
</div>
<div class="pager__item pager__item--next">
<a class=pager__link href=/pages/the-holy-grails-of-dev-ops/ rel=next>
<span class=pager__subtitle>Next&#8201;»</span>
<p class=pager__title>The Three Holy Grails of DevOps</p>
</a>
</div>
</nav>
</div>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2021 Lutz Behnke.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span>
</div>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>